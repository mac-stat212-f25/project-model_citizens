---
title: "Kate M"
---

```{r}
# load libraries
library(readr)
library(tidyverse)
library(skimr)
library(janitor)
library(psych)
library(GGally)
# read in data
MentalHealthSurvey <- read_csv("../data/raw/MentalHealthSurvey.csv")
```
```{r}
# clean names just in case
data <- MentalHealthSurvey %>% clean_names()

# Quick structure
glimpse(data)

# Summary statistics
skim(data)
```

```{r}
data %>% 
  summarize(across(everything(), ~ sum(is.na(.)))) %>% 
  pivot_longer(everything(), names_to = "variable", values_to = "missing_count") %>%
  arrange(desc(missing_count))
```

```{r}
data %>%
  select(academic_workload, academic_pressure, depression, anxiety, isolation, 
         average_sleep, sports_engagement, study_satisfaction) %>%
  psych::describe()
```

```{r}
data %>%
  ggplot(aes(x = academic_workload)) +
  geom_histogram(bins = 20) +
  labs(title="Distribution of Academic Workload")
```

```{r}
data %>%
  ggplot(aes(x = depression)) +
  geom_histogram(bins = 20) +
  labs(title="Distribution of Depression Levels")
```

```{r}
data %>%
  ggplot(aes(x = anxiety)) +
  geom_histogram(bins = 20) +
  labs(title="Distribution of Anxiety Levels")
```
# initial relationships
```{r}
data %>%
  ggplot(aes(x = academic_workload, y = anxiety)) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm") +
  labs(title="Academic Workload vs Anxiety")
```

```{r}
data %>%
  ggplot(aes(x = academic_pressure, y = depression)) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm") +
  labs(title="Academic Pressure vs Depression")
```

```{r}
data %>%
  ggplot(aes(x = academic_workload, y = anxiety, color = sports_engagement)) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm") +
  labs(title="Moderation: Sports Engagement x Workload on Anxiety")
```

```{r}
library(ggcorrplot)

corr_matrix <- cor(data %>%
                     select(academic_workload, academic_pressure, study_satisfaction,
                            depression, anxiety, isolation, future_insecurity),
                   use = "pairwise.complete.obs", method = "pearson")

ggcorrplot(corr_matrix, 
           lab = TRUE, lab_size = 3,
           hc.order = TRUE,
           type = "lower") +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.text.y = element_text(angle = 0)
  )


```

```{r}
data %>%
  ggplot(aes(x = academic_year, y = anxiety)) +
  geom_boxplot() +
  labs(title="Anxiety levels by Academic Year")
```

```{r}
data %>%
  ggplot(aes(x = gender, y = depression)) +
  geom_boxplot() +
  labs(title="Depression Levels by Gender")
```
```{r}
# What does student mental health look like overall?
mh_long <- MentalHealthSurvey |>
  select(depression, anxiety, isolation, future_insecurity) |>
  pivot_longer(cols = everything(),
               names_to = "outcome",
               values_to = "score")

ggplot(mh_long, aes(x = score, fill = outcome)) +
  geom_density(alpha = 0.4) +
  facet_wrap(~ outcome, scales = "free") +
  labs(
    title = "Distributions of Mental Health Outcomes",
    x = "Score",
    y = "Density"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

```{r}
library(tidyverse)

MentalHealthSurvey <- MentalHealthSurvey %>% 
  mutate(
    sleep_cat = case_when(
      average_sleep < 6 ~ "< 6 hours",
      average_sleep <= 8 ~ "6–8 hours",
      average_sleep > 8 ~ "> 8 hours",
      TRUE ~ NA_character_
    ),
    sleep_cat = factor(sleep_cat, levels = c("< 6 hours", "6–8 hours", "> 8 hours"))
  )
```

```{r}
MentalHealthSurvey %>% 
  pivot_longer(
    cols = c(depression, anxiety, isolation, future_insecurity),
    names_to = "outcome",
    values_to = "score"
  ) %>% 
  ggplot(aes(x = sleep_cat, y = score)) +
  geom_boxplot() +
  facet_wrap(~ outcome, scales = "free_y") +
  theme_minimal() +
  labs(
    title = "Mental-health outcomes by sleep category",
    x = "Average sleep per night",
    y = "Outcome score"
  )
```

```{r}
library(tidyverse)
library(stringr)

# 1. Create a variable: did they list sleep as a stress-relief activity?
MentalHealthSurvey <- MentalHealthSurvey %>% 
  mutate(
    sleep_relief = str_detect(str_to_lower(stress_relief_activities), "sleep"),
    sleep_relief = if_else(sleep_relief, "Sleep listed", "No sleep listed")
  )
```

```{r}
MentalHealthSurvey <- MentalHealthSurvey %>% 
  mutate(
    average_sleep = factor(
      average_sleep,
      levels = c("2-4 hrs", "4-6 hrs", "7-8 hrs"),
      ordered = TRUE
    )
  )

sleep_tab <- MentalHealthSurvey %>% 
  count(sleep_relief, average_sleep) %>% 
  group_by(sleep_relief) %>% 
  mutate(prop = n / sum(n))

sleep_tab
```

```{r}
ggplot(MentalHealthSurvey, aes(x = sleep_relief, fill = average_sleep)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal() +
  labs(
    title = "Sleep duration among students who do vs. don’t list sleep as stress relief",
    x = "Sleep listed as stress-relief activity?",
    y = "Proportion of students",
    fill = "Average sleep"
  )
```

