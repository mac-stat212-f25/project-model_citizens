---
title: "Professional Viz"
---

```{r}
library(tidyverse)
library(janitor) 
library(viridisLite)
library(stringr)
library(extrafont)
library(showtext)
```



```{r}
MentalHealthSurvey <- read_csv("../data/raw/MentalHealthSurvey.csv")
font_add(family = "RobotoCondensed", 
         regular = "data/raw/Roboto_Condensed/static/RobotoCondensed-Regular.ttf",
         bold = "data/raw/Roboto_Condensed/static/RobotoCondensed-Bold.ttf")
showtext_auto()
```
## Counting function
```{r}
percent_calc <- function(column_name) {
  MentalHealthSurvey |> 
  count({{column_name}}) |> 
  mutate(column_level = (n /sum(n)) * 100) |>
  rename(scale_system = {{column_name}}) |> 
  select(scale_system, column_level) |> 
  as.data.frame()
}
```
This is a function that will help me count the number of students that fall into each category, which will help me calculate my percentages. 

## Calculating Percentages & creating data set
```{r}
Depression <- percent_calc(depression) |> 
  rename(depression = column_level)

Anxiety <- percent_calc(anxiety) |> 
  rename(anxiety = column_level)

Isolation <- percent_calc(isolation) |> 
  rename(isolation = column_level)

Workload <- percent_calc(academic_workload) |> 
  rename(academic_workload = column_level)
  
Pressure <- percent_calc(academic_pressure) |> 
  rename(academic_pressure = column_level)

Satisfaction <- percent_calc(study_satisfaction) |> 
  rename(study_satisfaction = column_level)

Insecurity <- percent_calc(future_insecurity) |> 
  rename(future_insecurity = column_level)

Organized_data <- left_join(Depression, Anxiety) |> 
  full_join(Isolation) |>
  full_join(Workload) |>
  full_join(Pressure) |> 
  full_join(Satisfaction) |> 
  full_join(Insecurity) |> 
  pivot_longer(names_to = "Metric", cols = c(depression, anxiety, isolation, academic_workload, academic_pressure, study_satisfaction, future_insecurity)) |> 
    mutate(
    value = 
      case_when(
      is.na(value) ~ 0, 
      TRUE ~ value 
      )) |> 
  mutate(
    scale_system = factor(scale_system, levels = c("1", "2", "3", "4", "5")),
    value = case_when(
      scale_system %in% c("1", "2", "3") ~ -value,
      TRUE ~ value
    )
  ) |> 
  mutate(
    value = round(value)
  ) |> 
  mutate(scale_system = factor(scale_system, levels = c("5", "4", "1", "2", "3"))) 

Organized_data$Metric <- recode(Organized_data$Metric, 
                                "depression" = "Depression", 
                                "anxiety" = "Anxiety", 
                                "isolation" = "Isolation", 
                                "academic_workload" = "Academic Workload", 
                                "academic_pressure" = "Academic Pressure",
                                "study_satisfaction" = "Study Satisfaction", 
                                "future_insecurity" = "Future Insecurity"
                                )

```
In order to get the data that I wanted from the data set in the correct format for the graphic I had in mind I had to calculate for each individual variable I wanted to look at. Then I had to combine them into a dataset and pivot them, and then restructure large sections in order for it to show up exactly as I wanted. This part was edited a lot throughout the creation of the visualization. 

## Making Labels 
```{r}
Organzied_Data_labs <- Organized_data |> 
  mutate(
    scale_system = factor(scale_system, levels = c("4", "5", "1", "2", "3"))
  ) |> 
  group_by(Metric) |> 
  arrange(Metric, scale_system) |> 
  mutate(
    pos = cumsum(value) - (0.5 * value),  
    pos = case_when(
      (scale_system %in% c("1", "2", "3") & Metric == "Anxiety") ~ -pos - 8,
      (scale_system %in% c("1", "2", "3") & Metric == "Depression") ~ -pos - 10,
      (scale_system %in% c("1", "2", "3") & Metric == "Isolation") ~ -pos - 8,
      (scale_system %in% c("2", "3") & Metric == "Academic Workload") ~ -pos + 38,
      (scale_system %in% c("1", "2", "3") & Metric == "Academic Pressure") ~ -pos + 33,
      (scale_system %in% c("1", "2", "3") & Metric == "Study Satisfaction") ~ -pos + 35,
      (scale_system %in% c("1", "2", "3") & Metric == "Future Insecurity") ~ -pos - 24, 
      TRUE ~ pos
  ),
  value = abs(value), 
  ) |> 
  filter(value != 0) |> 
  mutate(
    value = as.character(value), 
    value = paste0(value, "%")
  )

desired_order <- c("Future Insecurity", "Study Satisfaction", "Academic Pressure", "Academic Workload", "Isolation", "Anxiety", "Depression")
```
In order to get the numbers that hover over each part of the bar chart I had to create a separate dataset specifically for the geom_text. They then had to be moved around for each individual variable. It was hard to get precise through the math, so that is why there are "random" numbers amended, as I found that is what made them look the best. 

## Creating graphs 
```{r fig.width = 16, fig.height = 6, fig.alt = "A bar graph demonstrating what percentage of students rated each of the following categories on a scale of 1-5 in realtion to school. For Isolation, 16% said 1, 15% said 2, 23% said 3 (or neutral), 21% said 4, and 25% said 5. For Depression 15% of students said 1, 16% of students said 2, 24% of students said 3, 22% of students said 4, and 23% of students said 5. For Anxiety, 11% of students said 1, 21% of students said 2, 22% of students said 3, 26% of students said 4, and 20% of students said 5. In Academic workload, no students said it was 1 level difficulty, only 6% said 2, 25% said 3, while 44% said 4 and 25% said 5. Lastly 6% of students said academic pressure was a 1, 7% said 2, 21% said 3, 37% said 4, and 30% said 5."}
ggplot(Organized_data, aes(x = factor(Metric, levels = desired_order), y = value, fill = scale_system)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(data = Organzied_Data_labs, aes(y = pos, label = value), 
            colour = "white", 
            size = 5, family = "RobotoCondensed", face = "bold") +
  coord_flip() +
  scale_fill_manual(
    values = c("1" = "#f45b5b", "2" = "#f4a261", "3" = "gray70",
               "4" = "#4ea8de", "5" = "#0077b6"), 
    limits = c("1", "2", "3", "4", "5")
  ) +
  scale_y_continuous(labels = abs) +
  labs(
    title = "Students Rating of Mental Health and College Factors on a Scale of 1-5",
    fill = "Level:",
    y = NULL, 
    x = NULL
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    axis.title.y = element_blank(),
    legend.position = "top",
    plot.title = element_text(size = 20, face = "bold", color = "#2a4d69", hjust = 0.5, family = "RobotoCondensed"), 
    plot.margin = unit(c(1, 2, 1, 1.5), "cm"), 
    axis.text.y = element_text(size = 15, family = "RobotoCondensed", face = "bold"), 
    legend.text = element_text(family = "RobotoCondensed", size = 14), 
    legend.title = element_text(family = "RobotoCondensed", size = 15)
  ) 
```
This final part creates the visualization! Through this we can see that a majority of students think that their academic workload and pressure are rather high, or above what might be a "manageable" level. Despite that, we are not seeing the same reflection in mental health markers. It would be logical to assume that as academic workload and pressure increase to an unmanageable level, that mental health might follow. While there are certainly a fair amount of students that feel these mental health symptoms to a high degree, it is not over 50%. 
