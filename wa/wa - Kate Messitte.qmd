---
title: "Kate M"
---

```{r}
# clean names just in case
data <- MentalHealthSurvey %>% clean_names()

# Quick structure
glimpse(data)

# Summary statistics
skim(data)
```

```{r}
# What does student mental health look like overall?
mh_long <- MentalHealthSurvey |>
  select(depression, anxiety, isolation, future_insecurity) |>
  pivot_longer(cols = everything(),
               names_to = "outcome",
               values_to = "score")

ggplot(mh_long, aes(x = score, fill = outcome)) +
  geom_density(alpha = 0.4) +
  facet_wrap(~ outcome, scales = "free") +
  labs(
    title = "Distributions of Mental Health Outcomes",
    x = "Score",
    y = "Density"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

```{r}
library(tidyverse)

MentalHealthSurvey <- MentalHealthSurvey %>% 
  mutate(
    sleep_cat = case_when(
      average_sleep < 6 ~ "< 6 hours",
      average_sleep <= 8 ~ "6–8 hours",
      average_sleep > 8 ~ "> 8 hours",
      TRUE ~ NA_character_
    ),
    sleep_cat = factor(sleep_cat, levels = c("< 6 hours", "6–8 hours", "> 8 hours"))
  )
```

# ```{r}
# # re-read data
# MentalHealthSurvey <- read_csv("../data/raw/MentalHealthSurvey.csv")
# 
# MentalHealthSurvey <- MentalHealthSurvey %>% 
#   mutate(
#     sleep_cat = case_when(
#       average_sleep >= 2 & average_sleep < 4 ~ "2–4 hours",
#       average_sleep >= 4 & average_sleep < 6 ~ "4–6 hours",
#       average_sleep >= 6 & average_sleep <= 8 ~ "6–8 hours",
#       TRUE ~ NA_character_
#     ),
#     sleep_cat = factor(
#       sleep_cat,
#       levels = c("2–4 hours", "4–6 hours", "6–8 hours")
#     )
#   )
# ```
# 
# ```{r}
# MentalHealthSurvey %>% 
#   pivot_longer(
#     cols = c(depression, anxiety, isolation, future_insecurity),
#     names_to = "outcome",
#     values_to = "score"
#   ) %>% 
#   ggplot(aes(x = sleep_cat, y = score)) +
#   geom_boxplot() +
#   facet_wrap(~ outcome, scales = "free_y") +
#   theme_minimal() +
#   labs(
#     title = "Mental-health outcomes by sleep category",
#     x = "Average sleep per night",
#     y = "Outcome score"
#   )
# ```

```{r}
library(tidyverse)
library(stringr)

# 1. Create a variable: did they list sleep as a stress-relief activity?
MentalHealthSurvey <- MentalHealthSurvey %>% 
  mutate(
    sleep_relief = str_detect(str_to_lower(stress_relief_activities), "sleep"),
    sleep_relief = if_else(sleep_relief, "Sleep listed", "No sleep listed")
  )
```

```{r}
MentalHealthSurvey <- MentalHealthSurvey %>% 
  mutate(
    average_sleep = factor(
      average_sleep,
      levels = c("2-4 hrs", "4-6 hrs", "7-8 hrs"),
      ordered = TRUE
    )
  )

sleep_tab <- MentalHealthSurvey %>% 
  count(sleep_relief, average_sleep) %>% 
  group_by(sleep_relief) %>% 
  mutate(prop = n / sum(n))

sleep_tab
```

```{r}
ggplot(MentalHealthSurvey, aes(x = sleep_relief, fill = average_sleep)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal() +
  labs(
    title = "Sleep duration among students who do vs. don’t list sleep as stress relief",
    x = "Sleep listed as stress-relief activity?",
    y = "Proportion of students",
    fill = "Average sleep"
  )
```
